
set(targets)

include_directories(./)


function(add_kerbal_sub_lib sublib)
    message("add sublib: ${sublib}")
    set(sublib_targets)
    aux_source_directory(./${sublib} files)
    foreach (file ${files})
        string(REGEX MATCH "./${sublib}/(.+)\\.inst\\.cpp$" _ ${file})
        if (CMAKE_MATCH_1)
            set(target inst.${sublib}.${CMAKE_MATCH_1})
            message("	add: ${target} <= ${file}")
            add_kerbal_inst_target(${target} ${file})
            set(sublib_targets ${sublib_targets} ${target})
        else ()
            message(WARNING "   ${file} has been ignored")
        endif ()
    endforeach ()
    set(targets ${targets} ${sublib_targets} PARENT_SCOPE)
    message("")
endfunction()

add_kerbal_sub_lib(algorithm)
add_kerbal_sub_lib(any)
add_kerbal_sub_lib(bitset)
add_kerbal_sub_lib(compare)
add_kerbal_sub_lib(container)
add_kerbal_sub_lib(hash)
add_kerbal_sub_lib(memory)
add_kerbal_sub_lib(numeric)
add_kerbal_sub_lib(optional)
add_kerbal_sub_lib(utility)

message("\n")

set(targets_count 0)
foreach (target ${targets})
    message("inst-target ${targets_count}: ${target}")
    math(EXPR targets_count "${targets_count} + 1")
endforeach ()

message("\n")
